# EOLT Test Script

## Install Dependencies

* Install python 
  * windows store
* Install following module:
```shell
python -m pip install python-docx
python -m pip install pyinstaller
```

## Build

The project will need to be built due to the different file structure across different systems that will use the script without the command line. To build the script double click on build.dat. You will be prompted to pick the config folder. NOTE: You will not be able to change this later on without rebuilding. Choose a folder in which you wish to put configuration files. 

Once finished building, you should find a file named ```run.exe```. This file will be the executable that will be used to run the script. At this point all other script files can be deleted 

## Launch

#### Command Line
If you would like to use the script without building you can do so by running it through the command line. First navigate to the directory with the script files. Before being able to run the script you will need to execute a different script that will prompt you to pick a config folder. The config folder will be stored in ```configdir.txt``` which must stay in the same directory as the rest of the scripts. The contents of ```configdir.txt``` can be changed later on by running the same script or manually. 

*Command to save configuration directory*
```shell
python saveConfigDir.py
```


From this point on to run the script, simply enter the following into the command line. 

*Command to run the script*
```shell
python runFactory.py
``` 
#### Automatic
Double click ```run.exe``` generated by the build script


## Usage

The program utilizes two configuration files that will be in the aforementioned config directory. The first one being ```locations.json```. This one does not need to be changed, though it can be. The second one is ```preferences.json```. This is where the preferences for retrieving data and other settings is stored. The syntax for these files will be discussed later.


#### Directory Selection
When the program launches you will be prompted with this:
```
Press enter to use previous locations
To choose new locations enter any other character:
```
When running the first time you should manually select the directories and files. To do this type any character and press enter. This will lead to a series of windows opening asking to select directories or files. If you have already entered directories in a previous run, or entered them manually in ```locations.json``` and want to keep the default then click cancel

1. The first directory chosen will be the output directory. This is the directory in which the output "summary.csv" will be placed.

2. The second one will be the directory in which certificates go. This directory must contain ```TEMPLATE.docx``` which is the template word document for the other certificates.

3. The third one will be the directory in which tests will be read from. It is safe to choose a parent directory as it will recursively check all sub directories


If manual directory selection was not chosen then the previous selections will be used.

#### Configuration Files
##### JSON Basics

JSON is the file type used to define settings for this script, similar to how ```.xml``` and ```.INI``` files are used.

Preferences are defined in a JSON file called ```preferences.json``` in the configuration directory. In this file the parsing of the different types of files is specified. FT2 SUM and FT3 are currently the only ones supported and needed.

The default ```preferences.json``` provided is shown below
```json
{
    "Test Preferences":{
        "FT2 SUM":[
            "Model ID@2",
            "TestResult@2",
            "Calibration Data:Air1@5",
            "Calibration Data:Air2@5",
            "Calibration Data:Glycol@5",
            "Post Calibration Data:Air1@5",
            "Post Calibration Data:Air2@5",
            "Post Calibration Data:Glycol@5",
            "Calibration Data:Air@5",
            "Post Calibration Data:Air@5"
        ],

        "FT3":[
            "Barcode 8"
        ]
    },

    "Generate Certificates":false
}
```


In a JSON file (the file type used for this script), data is stored in "dictionaries". The syntax for a dictionary is:
```json
{
    element1:data,
    element2:data,
    element3:data
}
```

All of the preferences are are stored in one big dictionary. The test preferences are specifically stored in a sub dictionary under the element "Test Preferences". In this sub dictionary, data to be retrieved from a specific test is defined in a list which is assigned to the key of its test. The syntax for a list is: ```[element1, element2, element3]```. All text must be surrounded by quotations marks. Inside the quotation marks the character "\\" must become "\\\\" 

Different tests have different syntax due to the nature of how the corresponding csv files are layed out. The keys for different tests are 
* FT1 - ft1 files
* FT2 SUM - ft2 summary files
* FT2 RAW - ft2 raw data files
* FT3 - ft3 files

The key "Generate Certificates" will either be ```false``` or ```true``` and will determine whether or not certificates should be generated.

##### Determining The Test

To determine what type of test a csv file is, the file name is observed with certain assumptions. If it contains "\_SUM" then it is FT2 SUM. Otherwise if it contains "\_RAW" it is FT2 RAW. Otherwise if it contains "FT3\_" or "ft3\_" it is FT3. Otherwise it is FT1.

##### FT2 SUM

The syntax for FT2 SUM test preferences is as follows: ```Region(conditional):Data Field@Column#```. The first aspect to define is Region. A Region starts in the csv file when there is a row with only the first cell having text. Calibration Data, Post Calibration Data, and UUT Responses are all examples of regions. This will only be included if necessary. As for the first entry, Model ID, it is not in a region therefore a Region should not be included. The next value to define, Data Field, is the value that is sought. This must be the text in the first cell in the row. After the '@' comes the column number, which is simply the number of the column that the data actually appears. The column numbers start at 1. 

Due to the nature of the SUM file, being that each file corresponds to one serial number, and data is spread across rows rather than columns, the script will go row by row checking for the data it needs. Therefore in the final summary, data will be logged in the order it appears in.

##### FT3

For FT3 your list will simply contain all of the headings/columns you want to retrieve. The script will then go through all the FT3 files and pick up the Serial Number and the data in the requested headings

#### Locations
Information about which directories to use are stored in ```locations.json``` in the config directory. The syntax for this file is included for completion and added functionality but it need not be touched if the user does not wish to.


The default ```locations.json``` provided is shown below
```json
{
    "out_dir": "",
    "certificate_dir": "",
    "search_dirs": [
        ""
    ]
}
```

* Under the key "out_dir", the directory for the output ```summary.csv``` is stored
* Under the key "certificate_dir" is where the directory with the ```TEMPLATE.docx``` and the other output certificates is stored. 
* Under the key "search_dirs" is a list of directories. These are the directories that will be searched recursively for test files to read. If using the graphical selection in the runtime of the script, only one directory can be selected. If one wishes to select more than one, they must resort to adding them here.

## Execution
After reading ```preferences.json``` and ```locations.json``` the parsing will commence, and data will be stored at the output folder in ```summary.csv```.

